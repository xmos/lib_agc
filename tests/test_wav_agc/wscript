import sys
import subprocess
sys.path.append('../../../lib_voice_toolbox/python')

def options(opt):
    opt.add_option('--target', action='store', default='test_wav_agc.xe')
    opt.add_option('--config_file', default='../../lib_agc/config/agc_2ch.json')
    opt.load('xwaf.xcommon')

def configure(conf):
    conf.load('xwaf.compiler_xcc')
    conf.env.PROJECT_ROOT = '../../..'
    conf.load('xwaf.xcommon')    

def build(bld):
    subprocess.call(['../../.venv/bin/python', '../../lib_agc/generate_config.py'])
    target_path = 'bin/' + bld.options.target
    bld.env.XSCOPE = bld.path.find_resource('config.xscope')
    depends_on = ['lib_agc', 'audio_test_tools', 'lib_voice_toolbox']
    makefile_opts = {}
    makefile_opts['SOURCE_DIRS'] = ['src']
    makefile_opts['TARGET'] = ['XCORE-AI-EXPLORER']
    makefile_opts['INCLUDE_DIRS'] = ['src', 'autogenerated']
    makefile_opts['XCC_FLAGS'] = ['-O2', '-g', '-Wall', '-report']
    makefile_opts['APP_NAME'] = [bld.options.target]
    makefile_opts['USED_MODULES'] = depends_on
    makefile_opts['XCOMMON_MAKEFILE'] = ['Makefile.common']
    bld.do_xcommon(makefile_opts)

def dist(ctx):
    ctx.load('xwaf.xcommon')

def distcheck(ctx):
    ctx.load('xwaf.xcommon')
    

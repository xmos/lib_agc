import sys
sys.path.append('../../../lib_voice_toolbox/python')
from json_utils import JsonHandler

def options(ctx):
    ctx.add_option('--target', action='store', default='test_wav_agc.xe')
    ctx.add_option('--config_file', default='../../lib_agc/config/agc_2ch.json')

def configure(conf):
    conf.load('xwaf.compiler_xcc')
    conf.env.PROJECT_ROOT = '../../..'

def build(bld):
    file_conv = JsonHandler(bld.options.config_file, False)
    file_conv.create_header_file('../../lib_agc/api/agc.h', ['./src/agc_conf.h'])
    target_path = 'bin/' + bld.options.target
    bld.env.TARGET_ARCH = 'XCORE-200-EXPLORER'
    bld.env.XSCOPE = bld.path.find_resource('config.xscope')
    includes = ['autogenerated'] 
    depends_on = ['lib_agc', 'audio_test_tools', 'lib_voice_toolbox']
    bld.env.XCC_FLAGS = ['-O2', '-g', '-Wall', '-report']
    source = bld.path.ant_glob('src/**/*.xc')
    bld.program(source=source, includes=includes, depends_on=depends_on,target=target_path)
